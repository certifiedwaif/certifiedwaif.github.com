<html>
<h1>Porting R code to Eigen with C++ 11</h1>

<p>A few years ago, I was porting some R code to C++ 11 so that I could call it
using Rcpp.  Compared to how difficult it used to be to incorporate C into your
R packages, Rcpp makes this relatively easy. I used Eigen, which I included
using the RcppEigen package.  Dr Jacqueline Floyd asked me on Twitter to write
about translating  the syntax, and I thought I'd write about some of the
important conceptual differences as well. I work primarily with numeric code,
so my writing will have that emphasis.</p>

<p>
<h2>Important conceptual differences</h2>
    <ul>
        <li>R indexes from 1, while C++ indexes from 0. This can be the source of
            many subtle indexing bugs if you're working with code that indexes
            into vectors or matrices a lot
        <li>R does not distinguish between single numbers and vectors
        <li>R's vector expressions don't always have a direct analogue in C++/Eigen. In particular, although indexing in Eigen is in the design stages, it's not in
the library yet. By comparison, R has a rich set of index operations, so porting code that uses these from R to C++ using Eigen can be a challenge
        <li>Expressions in R do not have types, while expressions in R do
        <li>C++11 will infer that the type of an expression involving an integer literal is an integer. That can be a problem if you're used to R's habit of making everything floating point when doing a division - you can find your expressions
being truncated and not immediately be able to figure out why
        <li>You always need to check that the corresponding functions in R and Eigen take parameters in the same order. For instance, seq() and LinSpaced() certainly don't.
    </ul>
        <p>Lastly, and most wonderfully, C++ is designed using the concept of <i>zero-cost abstraction</i>. While in R, certainly kinds of things such as for loops,
using classes and functions can carry a heavy performance penalty, in C++ these
all come essentially for free, and this is by design
        <p>The flip side of that is that you have to take more responsibility
or control. R is garbage-collected, and manages your memory for you. In C++,
you're expected to manage your memory yourself. If you have to dynamically allocate
and deallocate memory, this can be quite difficult, but thankfully numeric code
typically works with problems of a fixed size that don't change over the course
of the algorithm. So we avoid this difficulty almost entirely
</p>

<h2>Translating syntax between base R and C++11</h2>

<p>
In R, you can declare a vector of numbers by
<pre>
x <- c(0, 1, 4)
</pre>
while in C++ using Eigen you can write
<pre>
VectorXd x;
x &lt;&lt; 0, 1, 4;
</pre>
Matrices are almost as easy. In R, you'd write
<pre>
m <- matrix(c(1, 2, 3, 4), 2, 2)
</pre>
to declare a two by two array, while in C++/Eigen, you write
<pre>
MatrixXd m(2, 2);
m &lt;&lt; 1, 2, 3, 4;
</pre>
In both, elements are filled down the columns rather than the rows.
Both R and C++ with a good linear algebra library have operators for common
linear algebra operations like transposing a matrix, taking a dot product,
multiplying or inverting. Eigen's design is influenced by Matlab, and you'll
see that if you're a connoisseur of languages used by mathematicians and
statisticians.
</p>
</html>
